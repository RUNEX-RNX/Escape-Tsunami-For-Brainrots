if game.PlaceId ~= 131623223084840 then return end

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualUser = game:GetService("VirtualUser")

local player = Players.LocalPlayer

-- Anti AFK
player.Idled:Connect(function()
  VirtualUser:CaptureController()
  VirtualUser:ClickButton2(Vector2.new())
end)

-- Character setup
local hrp
local function setupChar(char)
  hrp = char:WaitForChild("HumanoidRootPart")
end
if player.Character then setupChar(player.Character) end
player.CharacterAdded:Connect(function(c)
  task.wait(1)
  setupChar(c)
end)

-- UI Init
local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()
local Window = WindUI:CreateWindow({
  Title = "ErrorServerHub",
  Icon = "monitor",
  Author = "By ErrorServer",
  Folder = "TsunamiBrainrots",
  Size = UDim2.fromOffset(560, 430),
  Theme = "Crimson",
  Transparent = true,
  Resizable = true,
  User = { Enabled = true }
})

local FarmTab = Window:Tab({ Title = "Farm", Icon = "zap" })
local UpgradeTab = Window:Tab({ Title = "Upgrade", Icon = "trending-up" })
local ThemeTab = Window:Tab({ Title = "Theme", Icon = "palette" })

-- Positions
local BASE_POS = Vector3.new(130,3,0)
local SECRET_POS = Vector3.new(2440,3,-4)

-- === MAIN ACTIONS ===
FarmTab:Section({ Title = "Main Actions" })

FarmTab:Button({
  Title = "Teleport to spawn",
  Callback = function()
    if hrp then hrp.CFrame = CFrame.new(BASE_POS) end
  end
})

FarmTab:Button({
  Title = "Find Best Brainrot",
  Callback = function()
    if not hrp then return end
    local secretFolder = workspace:FindFirstChild("ActiveBrainrots") and workspace.ActiveBrainrots:FindFirstChild("Secret")
    if secretFolder then
        local items = secretFolder:GetChildren()
        if #items > 0 then
            local target = items[1]:FindFirstChild("Handle")
            if target then
                hrp.CFrame = target.CFrame + Vector3.new(0, 3, 0)
            else
                hrp.CFrame = CFrame.new(SECRET_POS)
            end
        else
            hrp.CFrame = CFrame.new(SECRET_POS)
        end
    else
        hrp.CFrame = CFrame.new(SECRET_POS)
    end
  end
})

FarmTab:Button({
  Title = "Remove Tsunami",
  Callback = function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/slowzzxX/Remove-wallters/refs/heads/main/Ff", true))()
  end
})

-- === MOVEMENT (FLY & NOCLIP) ===
FarmTab:Section({ Title = "Movement" })

local flying = false
local noclip = false
local flySpeed = 2 -- Базовая скорость для CFrame полета

-- Noclip Logic
RunService.Stepped:Connect(function()
    if noclip and player.Character then
        for _, v in pairs(player.Character:GetDescendants()) do
            if v:IsA("BasePart") then v.CanCollide = false end
        end
    end
end)

FarmTab:Toggle({
  Title = "Noclip",
  Default = false,
  Callback = function(v) noclip = v end
})

FarmTab:Toggle({
  Title = "Fly Mode",
  Default = false,
  Callback = function(v)
    flying = v
    if player.Character and player.Character:FindFirstChild("Humanoid") then
        player.Character.Humanoid.PlatformStand = v
    end
  end
})

FarmTab:Slider({
  Title = "Fly Speed",
  Value = {Min = 1, Max = 10, Default = 2},
  Step = 0.5,
  Callback = function(v) flySpeed = v end
})

-- Улучшенный полет через CFrame (идеально для мобилок и ПК)
RunService.RenderStepped:Connect(function()
    if flying and hrp and player.Character then
        local cam = workspace.CurrentCamera
        local md = player.Character.Humanoid.MoveDirection
        
        if md.Magnitude > 0 then
            -- Движение в сторону взгляда камеры
            local direction = (cam.CFrame.LookVector * -md.Z) + (cam.CFrame.RightVector * md.X)
            hrp.CFrame = CFrame.new(hrp.Position, hrp.Position + cam.CFrame.LookVector) * CFrame.new(md.X * flySpeed, (direction.Y * flySpeed), md.Z * flySpeed)
            hrp.Velocity = Vector3.new(0,0,0) -- Убираем инерцию
        else
            hrp.Velocity = Vector3.new(0,0,0)
        end
    end
end)

-- === AUTO COLLECT (GLOBAL) ===
FarmTab:Section({ Title = "Global Farm" })

local autoCollect = false
local collectDelay = 0.5

FarmTab:Toggle({
  Title = "Auto Collect Money (Universal)",
  Default = false,
  Callback = function(v) autoCollect = v end
})

-- Функция ищет ВСЕ объекты Collect на карте
local function fireAllGlobalSlots()
    if not hrp then return end
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj.Name == "Collect" and obj:IsA("BasePart") then
            -- Проверяем, что это именно кнопка сбора (обычно они в слотах)
            pcall(function()
                firetouchinterest(hrp, obj, 0)
                firetouchinterest(hrp, obj, 1)
            end)
        end
    end
end

task.spawn(function()
  while true do
    task.wait(collectDelay)
    if autoCollect then
      fireAllGlobalSlots()
    end
  end
end)

-- Остальной функционал (Upgrades и т.д.)
local autoRebirth = false
local autoSpeed = false
local autoCarry = false
local autoSlots = false

UpgradeTab:Toggle({ Title = "Auto Upgrade Rebirth", Callback = function(v) autoRebirth = v end })
UpgradeTab:Toggle({ Title = "Auto Upgrade Speed", Callback = function(v) autoSpeed = v end })
UpgradeTab:Toggle({ Title = "Auto Upgrade Carry", Callback = function(v) autoCarry = v end })
UpgradeTab:Toggle({ Title = "Auto Upgrade Slots", Callback = function(v) autoSlots = v end })

local UpgradeBrainrot = ReplicatedStorage:WaitForChild("RemoteFunctions"):WaitForChild("UpgradeBrainrot")

local function upgradeAllSlots()
  for i = 1, 30 do
    pcall(function() UpgradeBrainrot:InvokeServer("Slot"..i) end)
  end
end

task.spawn(function()
  while true do
    task.wait(0.5)
    if autoSpeed then pcall(function() ReplicatedStorage.RemoteFunctions.UpgradeSpeed:InvokeServer(10) end) end
    if autoCarry then pcall(function() ReplicatedStorage.RemoteFunctions.UpgradeCarry:InvokeServer() end) end
    if autoRebirth then pcall(function() ReplicatedStorage.RemoteFunctions.Rebirth:InvokeServer() end) end
    if autoSlots then upgradeAllSlots() end
  end
end)

-- Theme
ThemeTab:Dropdown({
  Title = "Select Theme",
  Values = {"Dark","Light","Rose","Plant","Red","Indigo","Sky","Violet","Amber","Emerald","Midnight","Crimson","MonokaiPro","CottonCandy"},
  Default = "Crimson",
  Callback = function(t) WindUI:SetTheme(t) end
})

Window:SelectTab(1)
Window:SetVisible(true)
